# **Finding Lane Lines on the Road**

---

**Finding Lane Lines on the Road**

The goals / steps of this project are the following:
* Make a pipeline that finds lane lines on the road
* Reflect on your work in a written report


[//]: # (Image References)

[image1]: ./examples/grayscale.jpg "Grayscale"
[gray]: ./report_images/gray.jpg "Grayscale"
[blur]: ./report_images/blur_gray.jpg "Gaussian Smoothing"
[canny]: ./report_images/canny_edges.jpg "Canny Edges"
[masked]: ./report_images/masked_image.jpg "Masked Image"
[hough]: ./report_images/hough_lines.jpg "Hough Lines"
[overlay]: ./report_images/final_result.jpg "Final overlaid image"
[single]: ./report_images/single_line.jpg "Single continuous lines"

---

### Reflection

### 1. Description of Pipeline

My pipeline consisted of the following steps:

* Convert the original image to a grayscale image. Conversion to grayscale is
  needed because allows the edge detection algorithm (Canny) works with a
  single layer and not three RGB layers. The grayscale image is shown below:

![gray]

* Apply Gaussian blur to the grayscale image generated above to smooth out any
  irregularities. Since the Canny edge detection algorithm internally uses a
  Gaussian kernel for smoothing, this step is not critical. However, it gives
  us explicit control over the smoothing operation since the Canny algorithm
  interface does not allow us to control the smoothing operation. In the current
  work, a kernel size of 3 was used. The grayscale image after applying the
  Gaussian blur is shown below:


![blur]

* Once the grayscale image is available, it is fed into the Canny edge
  detection algorithm. The Canny algorithm requires an upper and lower
  threshold as input. Edges stronger than the upper threshold are retained
  while edges lower than the lower threshold are eliminated. Edges lying
  between the upper and lower thresholds are retained if they are connected to
  a strong edge (i.e., one greater than the upper threshold). In the current
  work, a low threshold of 50 and a high threshold of 100 was used. The image
  produced by the Canndy edge detector is shown below:

![canny]

* The edges generated by the Canny algorithm contain a lot of background
  information (trees, buildings, etc.) which are not relevant. We are only
  interested in capturing the lane lines. Since the location of the camera on
  the car is fixed we can expect the lane lines to fall within an certain
  region of the image. Edges that lie outside this region can be eliminated. To
  accomplish this, we define a region specified by a quadrilateral where we
  expect the lane lines to be present. Using this information, we generate a
  masked image by eliminating the edges outside the quadrilateral using OpenCV
  functions. The  masked image generated is shown below:

![masked]

* It is seen that besides the lane lines, the masked image contains some
  spurious edges.  To eliminate edges that are not part of the lane lines,  
  we use the concept of Hough lines to filter the edges by using certain
  criteria defined on the Hough space. The lines generated are then drawn on a
  blank image in the desired marker color (by default red). The parameters
  provided to the hough lines function were:
  * Distance resolution of the Hough grid in pixels, rho = 2,
  * Angular resolution of the Hough grid in radians, theta = pi/180,
  * Minimum number of intersections in Hough grid cell, threshold = 15,
  * Minimum number of pixels making up a line, min_line_length=40
  * Minimum gap in pixels between connectable line segments, min_line_gap = 20

  The resulting image is shown below:

![hough]

* Lastly, we combine the original image with the image containing the Hough
  lines to produce a weighted image which contains the lane lines in red. The
  weights for both images was taken to be 1 (i.e,. alpha=1, beta=1, gamma=0).

![overlay]

The above steps generate an output image where the lane lines are marked in
red. If the lane lines are discontinuous, the red lane lines are also
discontinuous. It would be useful to have a lane marking that is continuous and
extends on the left and right from the car all the way to the edge of the
region of interest. In order to draw a single continuous line, the draw_lines()
function was modified. The following changes were made:

* Firstly, each line was expressed in the form: y = mx + c, i.e., for each line
  its slope and its intercept on the bottom edge of the image was obtained.
  These were averaged for all lines. A single line corresponding to the average
  slope and the average intercept (on the bottom edge of the image). The
  formulas for computing the slope (m), constant (c) and intercepts are provided
  below:
  * m = (y2 - y1) / (x2 - x1)
  * c = y1 - m\*x1
  * y_bottom = image.shape[0]
  * x_bottom = (y_bottom - c) / m
  * y_top = int(0.6\*image.shape[0])
  * x_top = int((y_top - y_bottom) / m + x_bottom)    

* Using an average line based on the average slope and average intercept works
  fine for most images it does not work well for all. For some images, the
  presence of outlier edges can significantly alter the average slope and
  intercept to the point to produce inaccurate results.

* To fix this problem, a second iteration was performed where the outlier edges
  were eliminated based on their deviation from the average slope or average
  intercept value. Edges with a slope or intercept value that differs from the
  average values (computed in the previous step) were eliminated and were not
  used to compute the update average slope and intercept. Also, edges whose
  absolute value is below the ratio of the height/width of the image are also
  eliminated because this would imply intersection between the left and right
  lanes and is therefore not reasonable.

* The lines generated using the modified average slope and intercept values
  provided reasonable approximations for the lane lines, as shown below:

![single]

### 2. Identify potential shortcomings with your current pipeline

Although the approach outlined in the previous section generates single lines
that provide reasonable approximations of the lane lines, it is not without
shortcomings. Some of the shortcomings of this approach are:

* For images containing few edges or many outlier edges, the average slope and
  intercept is still likely to experience inaccuracies.

* For images where there is a sharp curvature in the lane (for e.g. when there
  is a sharp turn in the road), trying to approximate the curved lanes with a
  single line could lead to inaccuracies.

* When the car changes lanes or deviates significantly from the middle of the
  lane, the left and/or right lane lines may not fall within quadrilateral
  region. This could result in the lane lines going undetected or even
  completely ignored.


### 3. Suggest possible improvements to your pipeline

Some potential improvements to the algorithm are listed below:

* If the length of the continuous lines is reduced, the results would be less
  sensitive to outlier edges. Road curvatures, which typically increase farther
  away from the car, are also likely to have a lesser effect on the line slopes
  if the region of interest ahead of the car is smaller.

* Another approach is to process the region of interest in two (or more) parts,
  the lower half and the upper half. This can reduce the effect of sharp curves
  in the road by treating each part as locally linear.

* The parameters used in the current algorithm are not optimized. A detailed
  analysis can be performed to optimize these parameters. In particular, it
  would be helpful to optimize the parameters for images where failure or poor
  performance is observed.
